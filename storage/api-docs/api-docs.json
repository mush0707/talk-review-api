{
    "openapi": "3.0.0",
    "info": {
        "title": "Talk Review API",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:8080",
            "description": "Local Docker"
        }
    ],
    "paths": {
        "/api/auth/register": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Register a user (provider-based). Currently provider=local.",
                "operationId": "authRegister",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AuthRegisterRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Registered",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AuthTokenResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/auth/email/verification-notification": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Resend verification email (requires auth)",
                "operationId": "authResendVerification",
                "responses": {
                    "200": {
                        "description": "Sent",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GenericOkResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "422": {
                        "description": "Already verified / validation error"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/verify-email/{id}/{hash}": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "Verify email by signed link (redirects to frontend)",
                "operationId": "authVerifyEmail",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "hash",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "302": {
                        "description": "Redirect to frontend"
                    },
                    "403": {
                        "description": "Invalid/expired signature"
                    }
                }
            }
        },
        "/api/auth/login": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Login (provider-based). Currently provider=local.",
                "operationId": "authLogin",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AuthLoginRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Logged in",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AuthTokenResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Invalid credentials / validation error"
                    }
                }
            }
        },
        "/api/auth/me": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "Get current user",
                "operationId": "authMe",
                "responses": {
                    "200": {
                        "description": "Current user",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AuthMeResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/logout": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Logout (revoke current token)",
                "operationId": "authLogout",
                "responses": {
                    "200": {
                        "description": "Logged out",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GenericOkResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/proposals": {
            "get": {
                "tags": [
                    "Proposals"
                ],
                "summary": "Search/list proposals (role-scoped)",
                "operationId": "proposalsIndex",
                "parameters": [
                    {
                        "name": "search",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        },
                        "example": "laravel"
                    },
                    {
                        "name": "status",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "pending",
                                "approved",
                                "rejected"
                            ]
                        },
                        "example": "pending"
                    },
                    {
                        "name": "tag_ids[]",
                        "in": "query",
                        "required": false,
                        "style": "form",
                        "explode": true,
                        "schema": {
                            "type": "array",
                            "items": {
                                "type": "integer"
                            }
                        },
                        "example": [
                            1,
                            2
                        ]
                    },
                    {
                        "name": "page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 1
                        },
                        "example": 1
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 10
                        },
                        "example": 10
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Paginated proposals",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedProposalResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden / Email not verified"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Proposals"
                ],
                "summary": "Create proposal (speaker only)",
                "operationId": "proposalsStore",
                "requestBody": {
                    "required": true,
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "$ref": "#/components/schemas/ProposalCreateRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created proposal",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Proposal"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden / Email not verified"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/proposals/{proposal}": {
            "get": {
                "tags": [
                    "Proposals"
                ],
                "summary": "Get proposal by id (speaker can only access own)",
                "operationId": "proposalsShow",
                "parameters": [
                    {
                        "name": "proposal",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "example": 10
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Proposal",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Proposal"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "404": {
                        "description": "Not found"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/proposals/{proposal}/status": {
            "patch": {
                "tags": [
                    "Proposals"
                ],
                "summary": "Change proposal status (admin only)",
                "operationId": "proposalsChangeStatus",
                "parameters": [
                    {
                        "name": "proposal",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "example": 10
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ProposalStatusChangeRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "204": {
                        "description": "No content"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "404": {
                        "description": "Not found"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/proposals/{proposal}/reviews": {
            "get": {
                "tags": [
                    "Reviews"
                ],
                "summary": "List reviews for a proposal (paginated, searchable)",
                "operationId": "reviewsIndex",
                "parameters": [
                    {
                        "name": "proposal",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "example": 10
                    },
                    {
                        "name": "search",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        },
                        "example": "great"
                    },
                    {
                        "name": "rating_min",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 5,
                            "minimum": 1
                        },
                        "example": 3
                    },
                    {
                        "name": "rating_max",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 5,
                            "minimum": 1
                        },
                        "example": 5
                    },
                    {
                        "name": "page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 1
                        },
                        "example": 1
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 10
                        },
                        "example": 10
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Paginated reviews",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedReviewResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "404": {
                        "description": "Not found"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/proposals/{proposal}/reviews/me": {
            "put": {
                "tags": [
                    "Reviews"
                ],
                "summary": "Upsert current reviewer review for proposal",
                "operationId": "reviewsUpsertMine",
                "parameters": [
                    {
                        "name": "proposal",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "example": 10
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ReviewUpsertRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created/updated review",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ProposalReview"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "404": {
                        "description": "Not found"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/tags": {
            "get": {
                "tags": [
                    "Tags"
                ],
                "summary": "List tags (autocomplete / library)",
                "operationId": "tagsIndex",
                "parameters": [
                    {
                        "name": "search",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        },
                        "example": "tech"
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 20
                        },
                        "example": 20
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Tags list",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Tag"
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden / Email not verified"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        }
    },
    "components": {
        "schemas": {
            "User": {
                "required": [
                    "id",
                    "name",
                    "email",
                    "role"
                ],
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 1
                    },
                    "name": {
                        "type": "string",
                        "example": "Mush"
                    },
                    "email": {
                        "type": "string",
                        "example": "mush@example.com"
                    },
                    "role": {
                        "description": "Role name from DB roles table",
                        "type": "string",
                        "example": "speaker"
                    }
                },
                "type": "object"
            },
            "AuthRegisterRequest": {
                "required": [
                    "provider",
                    "name",
                    "email",
                    "password",
                    "password_confirmation",
                    "role"
                ],
                "properties": {
                    "provider": {
                        "type": "string",
                        "example": "local"
                    },
                    "name": {
                        "type": "string",
                        "example": "Mush"
                    },
                    "email": {
                        "type": "string",
                        "example": "mush@example.com"
                    },
                    "password": {
                        "type": "string",
                        "example": "password123"
                    },
                    "password_confirmation": {
                        "type": "string",
                        "example": "password123"
                    },
                    "role": {
                        "description": "Validated via exists:roles,name",
                        "type": "string",
                        "example": "speaker"
                    },
                    "oauth_token": {
                        "description": "Reserved for future OAuth providers",
                        "type": "string",
                        "example": null,
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "AuthLoginRequest": {
                "required": [
                    "provider",
                    "email",
                    "password"
                ],
                "properties": {
                    "provider": {
                        "type": "string",
                        "example": "local"
                    },
                    "email": {
                        "type": "string",
                        "example": "mush@example.com"
                    },
                    "password": {
                        "type": "string",
                        "example": "password123"
                    },
                    "oauth_token": {
                        "description": "Reserved for future OAuth providers",
                        "type": "string",
                        "example": null,
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "AuthFlags": {
                "required": [
                    "must_verify_email",
                    "email_verified"
                ],
                "properties": {
                    "must_verify_email": {
                        "type": "boolean",
                        "example": true
                    },
                    "email_verified": {
                        "type": "boolean",
                        "example": false
                    }
                },
                "type": "object"
            },
            "AuthTokenResponse": {
                "required": [
                    "token",
                    "user",
                    "must_verify_email",
                    "email_verified"
                ],
                "properties": {
                    "token": {
                        "type": "string",
                        "example": "1|sanctum_token_here"
                    },
                    "user": {
                        "$ref": "#/components/schemas/User"
                    },
                    "must_verify_email": {
                        "type": "boolean",
                        "example": true
                    },
                    "email_verified": {
                        "type": "boolean",
                        "example": false
                    }
                },
                "type": "object"
            },
            "AuthMeResponse": {
                "required": [
                    "user",
                    "must_verify_email",
                    "email_verified"
                ],
                "properties": {
                    "user": {
                        "$ref": "#/components/schemas/User"
                    },
                    "must_verify_email": {
                        "type": "boolean",
                        "example": true
                    },
                    "email_verified": {
                        "type": "boolean",
                        "example": false
                    }
                },
                "type": "object"
            },
            "GenericOkResponse": {
                "required": [
                    "ok"
                ],
                "properties": {
                    "ok": {
                        "type": "boolean",
                        "example": true
                    }
                },
                "type": "object"
            },
            "PaginationMeta": {
                "required": [
                    "current_page",
                    "per_page",
                    "total",
                    "last_page"
                ],
                "properties": {
                    "current_page": {
                        "type": "integer",
                        "example": 1
                    },
                    "per_page": {
                        "type": "integer",
                        "example": 10
                    },
                    "total": {
                        "type": "integer",
                        "example": 42
                    },
                    "last_page": {
                        "type": "integer",
                        "example": 5
                    }
                },
                "type": "object"
            },
            "Proposal": {
                "required": [
                    "id",
                    "speaker_id",
                    "title",
                    "description",
                    "status"
                ],
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 10
                    },
                    "speaker_id": {
                        "type": "integer",
                        "example": 1
                    },
                    "title": {
                        "type": "string",
                        "example": "Modern Laravel at Scale"
                    },
                    "description": {
                        "type": "string",
                        "example": "We will discuss queues, caching, and architecture..."
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "approved",
                            "rejected"
                        ],
                        "example": "pending"
                    },
                    "attachment_path": {
                        "type": "string",
                        "example": "proposals/abc123.pdf",
                        "nullable": true
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Tag"
                        },
                        "nullable": true
                    },
                    "reviews_count": {
                        "type": "integer",
                        "example": 2,
                        "nullable": true
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-11-27T12:00:00+00:00",
                        "nullable": true
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-11-27T12:10:00+00:00",
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "ProposalCreateRequest": {
                "required": [
                    "title",
                    "description"
                ],
                "properties": {
                    "title": {
                        "type": "string",
                        "example": "Modern Laravel at Scale"
                    },
                    "description": {
                        "type": "string",
                        "example": "We will discuss queues, caching, and architecture..."
                    },
                    "tag_ids": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        },
                        "example": [
                            1,
                            2
                        ],
                        "nullable": true
                    },
                    "tag_names": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "example": [
                            "Technology",
                            "Business"
                        ],
                        "nullable": true
                    },
                    "file": {
                        "description": "PDF only, max 4MB",
                        "type": "string",
                        "format": "binary",
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "ProposalStatusChangeRequest": {
                "required": [
                    "status"
                ],
                "properties": {
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "approved",
                            "rejected"
                        ],
                        "example": "approved"
                    }
                },
                "type": "object"
            },
            "PaginatedProposalResponse": {
                "required": [
                    "data",
                    "meta"
                ],
                "properties": {
                    "data": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Proposal"
                        }
                    },
                    "meta": {
                        "$ref": "#/components/schemas/PaginationMeta"
                    }
                },
                "type": "object"
            },
            "ProposalReview": {
                "required": [
                    "id",
                    "proposal_id",
                    "reviewer_id",
                    "rating"
                ],
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 99
                    },
                    "proposal_id": {
                        "type": "integer",
                        "example": 10
                    },
                    "reviewer_id": {
                        "type": "integer",
                        "example": 5
                    },
                    "rating": {
                        "type": "integer",
                        "maximum": 5,
                        "minimum": 1,
                        "example": 5
                    },
                    "comment": {
                        "type": "string",
                        "example": "Strong topic, good structure.",
                        "nullable": true
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-11-27T12:30:00+00:00",
                        "nullable": true
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-11-27T12:35:00+00:00",
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "ReviewUpsertRequest": {
                "required": [
                    "rating"
                ],
                "properties": {
                    "rating": {
                        "type": "integer",
                        "maximum": 5,
                        "minimum": 1,
                        "example": 4
                    },
                    "comment": {
                        "type": "string",
                        "example": "Nice, but needs more examples.",
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "PaginatedReviewResponse": {
                "required": [
                    "data",
                    "meta"
                ],
                "properties": {
                    "data": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/ProposalReview"
                        }
                    },
                    "meta": {
                        "$ref": "#/components/schemas/PaginationMeta"
                    }
                },
                "type": "object"
            },
            "Tag": {
                "required": [
                    "id",
                    "name",
                    "slug"
                ],
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 1
                    },
                    "name": {
                        "type": "string",
                        "example": "Technology"
                    },
                    "slug": {
                        "type": "string",
                        "example": "technology"
                    }
                },
                "type": "object"
            }
        },
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "bearerFormat": "Sanctum",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "Auth",
            "description": "Authentication endpoints"
        },
        {
            "name": "Proposals",
            "description": "Talk proposals"
        },
        {
            "name": "Reviews",
            "description": "Proposal reviews"
        },
        {
            "name": "Tags",
            "description": "Tags library (autocomplete)"
        }
    ]
}